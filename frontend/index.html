<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Librarian</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Smart Librarian â€“ AI Book Recommender</h1>
    <div style="display: flex; align-items: center; justify-content: center;">
        <button id="voiceBtn" style="margin-right:8px;">ðŸŽ¤ Speak</button>
        <input type="text" id="query" placeholder="Enter theme or context">
    </div>
    <div style="display: flex; justify-content: center;">
        <button onclick="getRecommendation()" style="margin-top:10px;">Get Recommendation</button>
    </div>
    <div id="result"></div>
    <div id="summary"></div>
    <button onclick="playTTS()">Listen to Recommendation</button>
    <audio id="audio" controls style="display:none;"></audio>

    <script>
    // Speech to text
    const voiceBtn = document.getElementById('voiceBtn');
    const queryInput = document.getElementById('query');
    let recognition;
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
    } else if ('SpeechRecognition' in window) {
        recognition = new SpeechRecognition();
    }
    if (recognition) {
        recognition.lang = 'ro-RO'; // Change to 'en-US' for English
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            queryInput.value = transcript;
        };
        recognition.onerror = function(event) {
            alert('Speech recognition error: ' + event.error);
        };
        voiceBtn.onclick = function() {
            recognition.start();
            voiceBtn.textContent = 'ðŸŽ¤ Listening...';
        };
        recognition.onend = function() {
            voiceBtn.textContent = 'ðŸŽ¤ Speak';
        };
    } else {
        voiceBtn.disabled = true;
        voiceBtn.title = 'Speech recognition not supported in this browser.';
    }
    async function getRecommendation() {
        const query = document.getElementById('query').value;
        const res = await fetch('/recommend', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({query})
        });
        const data = await res.json();
        let result = '';
        if (data.length > 0) {
            result = `<b>Recommendation:</b> ${data[0].title}<br>${data[0].text}`;
            document.getElementById('result').innerHTML = result;
            getSummary(data[0].title);
        } else {
            document.getElementById('result').innerHTML = 'No recommendation found.';
        }
    }
    async function getSummary(title) {
        const res = await fetch(`/summary?title=${encodeURIComponent(title)}`);
        const data = await res.json();
        document.getElementById('summary').innerHTML = `<b>Summary:</b> ${data.summary}`;
    }
    async function playTTS() {
        const text = document.getElementById('result').innerText + '\n' + document.getElementById('summary').innerText;
        const res = await fetch('/tts', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text})
        });
        const data = await res.json();
        const audio = document.getElementById('audio');
        audio.src = data.audio_path;
        audio.style.display = 'block';
        audio.play();
    }
    </script>
</body>
</html>
